{% extends 'auth_base.html' %}
{% load static %}

{% block title %}
  Signup | FitNexus
{% endblock %}

{% block content %}
  <section class="py-lg-5 py-4">
    <div class="container">
      <div class="row align-items-center justify-content-center">
        <div class="col-md-6">
          <div class="codex-authbox px-lg-5">
            <div class="codex-brand mb-lg-5 mb-4 text-center">
              <a class="d-flex align-items-center justify-content-center" href="#">
                <img class="img-fluid" src="{% static 'assets/images/logo/logo.png' %}" alt="theme-logo" />
                <span class="fs-3 align-middle ms-2 lh-1">FitNexus</span>
              </a>
            </div>

            <h3>Join FitNexus ðŸ’ª</h3>
            <p class="mb-lg-4 mb-2">Start your fitness journey today. Register to track workouts, goals, and progress.</p>

            <!-- Error display -->
            {% if messages %}
              {% for message in messages %}
                <div class="alert alert-{{ message.tags }} mt-2">{{ message }}</div>
              {% endfor %}
            {% endif %}

            {% if form.errors %}
              <div class="alert alert-danger mt-3">
                <ul class="mb-0">
                  {% for field in form %}
                    {% for error in field.errors %}
                      <li>
                        <strong>{{ field.label }}:</strong> {{ error }}
                      </li>
                    {% endfor %}
                  {% endfor %}
                  {% for error in form.non_field_errors %}
                    <li>{{ error }}</li>
                  {% endfor %}
                </ul>
              </div>
            {% endif %}

            <form method="post" novalidate>
              {% csrf_token %}
              <div class="row gy-3">
                <!-- Username -->
                <div class="col-md-12">
                  <label class="form-label">Username</label>
                  <input type="text" name="username" class="form-control" placeholder="Choose a username" required />
                </div>

                <!-- Email -->
                <div class="col-md-12">
                  <label class="form-label">Email</label>
                  <input type="email" name="email" class="form-control" placeholder="Example@gmail.com" required />
                </div>

                <!-- Age -->
                <div class="col-md-6">
                  <label class="form-label">Age</label>
                  <input type="number" name="age" class="form-control" placeholder="Enter your age" required />
                </div>

                <!-- Gender -->
                <div class="col-md-6">
                  <label class="form-label">Gender</label>
                  <select name="gender" class="form-select" required>
                    <option value="">Select</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                  </select>
                </div>

                <!-- Height -->
                <div class="col-md-6">
                  <label class="form-label">Height (cm)</label>
                  <input type="number" name="height_cm" class="form-control" placeholder="e.g. 180" required />
                </div>

                <!-- Weight -->
                <div class="col-md-6">
                  <label class="form-label">Weight (kg)</label>
                  <input type="number" name="weight_kg" class="form-control" placeholder="e.g. 75" required />
                </div>

                <!-- Goal (fixed choices) -->
                <div class="col-md-12">
                  <label class="form-label">Fitness Goal</label>
                  <select name="goal" class="form-select" required>
                    <option value="">Select goal</option>
                    <option value="Weight Loss">Weight Loss</option>
                    <option value="Muscle Gain">Muscle Gain</option>
                    <option value="Maintenance">Maintenance</option>
                  </select>
                </div>

                <!-- Passwords -->
                <div class="col-md-6">
                  <label class="form-label">Password</label>
                  <input type="password" name="password1" class="form-control" placeholder="At least 8 characters" required />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Confirm Password</label>
                  <input type="password" name="password2" class="form-control" placeholder="Re-enter password" required />
                </div>

                <!-- Submit -->
                <div class="col-md-12 mt-3">
                  <button type="submit" class="btn btn-primary w-100 py-3">Create Account</button>
                </div>
              </div>
            </form>

            <div class="text-center mt-4">
              Already have an account?
              <a href="{% url 'users:login' %}" class="text-primary">Sign in</a>
            </div>
          </div>
        </div>

        <!-- Right side image -->
        <div class="col-lg-6 d-none d-lg-block">
          <img src="{% static 'assets/images/welcome.png' %}" alt="Welcome Image" class="img-fluid" />
        </div>
      </div>
    </div>
  </section>

  <script>
    $(document).ready(function () {
      jQuery.validator.addMethod(
        'regex',
        function (value, element, regexp) {
          var re = new RegExp(regexp)
          return this.optional(element) || re.test(value)
        },
        'Invalid format.'
      )
    
      $('form').validate({
        rules: {
          username: {
            required: true,
            minlength: 3,
            maxlength: 20,
            regex: '^[A-Za-z0-9_]+$'
          },
          email: {
            required: true,
            email: true
          },
          age: {
            required: true,
            number: true,
            min: 13,
            max: 100
          },
          gender: {
            required: true
          },
          height_cm: {
            required: true,
            number: true,
            min: 50,
            max: 300
          },
          weight_kg: {
            required: true,
            number: true,
            min: 20,
            max: 300
          },
          goal: {
            required: true
          },
          password1: {
            required: true,
            minlength: 8,
            regex: '^(?=.*[A-Za-z])(?=.*\\d)[A-Za-z\\d!@#$%^&*]+$'
          },
          password2: {
            required: true,
            equalTo: "[name='password1']"
          }
        },
        messages: {
          username: {
            required: 'Please enter a username',
            minlength: 'Username must be at least 3 characters',
            maxlength: "Username can't exceed 20 characters",
            regex: 'Username can only contain letters, numbers, and underscores'
          },
          email: {
            required: 'Please enter your email',
            email: 'Enter a valid email address'
          },
          age: {
            required: 'Please enter your age',
            number: 'Please enter a valid number',
            min: 'Age must be at least 13',
            max: 'Please enter a realistic age'
          },
          gender: {
            required: 'Please select your gender'
          },
          height_cm: {
            required: 'Please enter your height',
            number: 'Enter a valid number',
            min: 'Height must be above 50 cm',
            max: 'Please enter a realistic height'
          },
          weight_kg: {
            required: 'Please enter your weight',
            number: 'Enter a valid number',
            min: 'Weight must be at least 20 kg',
            max: 'Please enter a realistic weight'
          },
          goal: {
            required: 'Please select your fitness goal'
          },
          password1: {
            required: 'Please enter a password',
            minlength: 'Password must be at least 8 characters long',
            regex: 'Password must include at least one letter and one number'
          },
          password2: {
            required: 'Please confirm your password',
            equalTo: 'Passwords do not match'
          }
        },
        errorElement: 'div',
        errorPlacement: function (error, element) {
          error.addClass('text-danger mt-1')
          element.closest('.col-md-12, .col-md-6').append(error)
        },
        highlight: function (element) {
          $(element).addClass('is-invalid')
        },
        unhighlight: function (element) {
          $(element).removeClass('is-invalid')
        }
      })
    })
  </script>
{% endblock %}
